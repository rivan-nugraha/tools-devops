const firebaseConfig = {
    apiKey: "AIzaSyB1JES7FtWNBoz9obp-5Z6HifP5XCsUsOI",
    authDomain: "gambar-78b2b.firebaseapp.com",
    projectId: "gambar-78b2b",
    storageBucket: "gambar-78b2b.appspot.com",
    messagingSenderId: "694976070405",
    appId: "1:694976070405:web:eef580e9823e39e64dad6c",
    measurementId: "G-YX2KKT4KRH"
};
const firebases = require('firebase')
const fsPromise = require('fs/promises')

const firebase = firebases.initializeApp(firebaseConfig)
async function main() {
cle	const dataString = await fsPromise.readFile('../tm_barang_image')
	const dataParsed = JSON.parse(dataString)
	console.log(dataParsed[0])
	return false;
    for (let i = 0; i <= 12000; i++) {
        const file = await fsPromise.readFile(`../images/${String(i).padStart(8, '0')}.jpg`)
            .then(async res => {
                await postImage(res, String(i).padStart(8, '0'))
                    .then(res => console.log(res))
                    .catch(err => console.log(err))
            })
            .catch(err => console.log(err))

        console.log('file', i, 'has been push!')
    }
}

function postImage(file, name) {
    return new Promise((resolve, reject) => {
        const storage = firebase.storage();
        let stoageRef = storage.ref("NSIPIC/TMS/foto_produk/" + name + ".jpg");
        stoageRef
            .put(file)
            .then((res) => {
                stoageRef.getDownloadURL().then(function (url) {
                    resolve(url);
                });
            })
            .catch((err) => {
                reject(JSON.parse(err));
            });
    });
}

main()
